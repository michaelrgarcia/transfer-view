/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={};async function t(e,n,r){if(0!==e.length){const o=e.splice(0,7);try{const s=await async function(e,t){const n=JSON.stringify(e),r=await fetch("https://assistscraper.onrender.com/articulation-data",{body:n,method:"POST",headers:{"Content-Type":"application/json"},signal:t});if(!r.ok)throw new Error("api is not ok");const o=await r.json();return Object.values(o)}(o,r);n.push(...s),console.log("processed request"),await t(e,n,r)}catch(e){"AbortError"===e.name?console.log("aborted request"):console.error("error processing request:",e)}}}function n(e,t,n){const r=document.createElement("option");return r.textContent=e,r.value=e,t&&n&&r.setAttribute(`data-${n}`,t),r}function r(e){const t=document.createElement("option");return t.textContent=`Select a ${e}`,t.value="",t.disabled=!0,t.selected=!0,t}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var r=n.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=r[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.p,e.p,e.p,e.p,e.p;const o=e=>{const t=(e=e.trim()).match("[0-9.]+");let n,r="ms";const o=t?t[0]:"";return o&&(r=e.split(o)[1],n=Number(o)),{num:n,unit:r}},s=function(e){const t=function(e){const t=t=>{return window.getComputedStyle(e).getPropertyValue(t)||e.style[(n=t,n.replace(/-([a-z])/g,(e=>e[1].toUpperCase())))];var n},n=t("transition-delay")||"0ms",r=t("transition-duration")||"0ms",s=Array.isArray(r)?r:[r],a=Array.isArray(n)?n:[n];let c,i=0;return s.push.apply(s,a),s.forEach((e=>{e.split(",").forEach((e=>{e=(e=>{const t=o(e),n=t?t.num:void 0;if(!n)return"";let r=n;return"s"===e.replace(n+"","")&&(r=1e3*n),r+"ms"})(e),c=o(e),c.num&&c.num>i&&(i=c.num)}))})),i}(e);return new Promise((n=>{t>0?setTimeout((()=>{n(e)}),t):n(e)}))},a=document.querySelector("dialog"),c=document.querySelector("form");function i(e){const t=e,n=t.querySelector("select"),r=t.querySelectorAll(":not(.loading)");n&&(n.disabled=!0),r.forEach((e=>{e.setAttribute("aria-disabled","true")}))}function l(e){const t=e,n=t.querySelector("select"),r=t.querySelectorAll(":not(.loading)");n&&(n.disabled=!1),r.forEach((e=>{e.setAttribute("aria-disabled","false")}))}function u(e,t){i(e),function(e){const t=e;t.style.opacity=1,t.style.display="block"}(t)}function d(e,t){l(e),function(e){const t=e;t.style.opacity=0,t.style.display="none"}(t)}const p=sessionStorage.getItem("requestInProgress"),y=[document.getElementById("four-year"),document.getElementById("major"),document.getElementById("class")],f=y[0],h=y[1],m=y[2],g=(document.querySelector("form"),document.querySelector(".submit")),w=document.querySelector("dialog"),b=document.querySelector(".close-dialog");document.addEventListener("DOMContentLoaded",(()=>{for(let e=1;e<y.length;)y[e].parentNode&&(i(y[e].parentNode),e+=1);i(g.parentNode),async function(e){const t=e.parentNode,o=t.querySelector(".loading");a.showModal(),a.style.opacity=1,u(t,o);const s=await async function(){try{const e="https://classglance.onrender.com/schools/four-years",t=await fetch(e),n=await t.json();return Object.values(n)}catch(e){return console.error("Error fetching universities:",e),null}}(),c=e,i=r("school");c.appendChild(i),s.forEach((e=>{if(e.id<200){const t=n(e.name,e.id,"sending");c.appendChild(t)}})),a.style.opacity=0,a.close(),d(t,o)}(y[0])})),y[0].addEventListener("input",(()=>{const e=f.options[f.selectedIndex].dataset.sending;(async function(e,t){const o=e.parentElement,s=o.querySelector(".loading");u(o,s);const a=await async function(e){try{const t=`https://classglance.onrender.com/schools/major-data/${e}/74`,n=await fetch(t),r=await n.json();return Object.values(r)}catch(t){return console.error(`Error fetching majors for ${e}:`,t),null}}(t),c=e,i=r("major");c.replaceChildren(),c.appendChild(i),a.forEach((e=>{const t=n(e.major,e.key,"key");c.appendChild(t)})),d(o,s)})(h,e),h.replaceChildren(),m.replaceChildren(),i(m.parentNode),i(g.parentNode)})),y[1].addEventListener("input",(()=>{const e=f.options[f.selectedIndex].dataset.sending,t=h.options[h.selectedIndex],{key:o}=t.dataset;m.replaceChildren(),async function(e,t,o){const s=e.parentNode,a=s.querySelector(".loading");u(s,a);const c=await async function(e,t){try{const n=`https://classglance.onrender.com/schools/74/6/${e}/${t}/lower-divs`,r=await fetch(n),o=await r.json();return Object.values(o)}catch(t){return console.error(`Error fetching lower divs for ${e}:`,t),null}}(t,o),i=e,l=r("class");i.replaceChildren(),i.appendChild(l),c.forEach((e=>{if(Array.isArray(e)){let t,r="";e.forEach(((n,o)=>{if("string"==typeof n&&(t=n.toLowerCase(),o<e.length-1&&(r+=` ${t} `)),n.prefix&&n.courseNumber&&n.courseTitle){const{prefix:e}=n,{courseNumber:t}=n;r+=` ${e} ${t} `}}));const o=n(r);i.appendChild(o)}else{const t=n(`${e.prefix} ${e.courseNumber} - ${e.courseTitle}`,null,null);i.appendChild(t)}})),d(s,a)}(m,e,o),i(g.parentNode)})),y[2].addEventListener("input",(()=>{p||l(g.parentNode)})),g.addEventListener("click",(async e=>{const n=f.options[f.selectedIndex].dataset.sending,r=h.options[h.selectedIndex].dataset.key;if(i(g.parentNode),m.value&&!p){const e=await async function(e,t){const n=[],r=await async function(){try{const e="https://classglance.onrender.com/schools/community-colleges",t=await fetch(e),n=await t.json();return Object.values(n)}catch(e){return console.error("Error fetching community colleges:",e),null}}(),o=e,s=t;return r.forEach((e=>{if(e.id){const t=`https://assist.org/api/articulation/Agreements?Key=74/${e.id}/to/${o}/Major/${s}`;n.push({link:t})}})),n}(n,r);c.style.opacity=0,s(c).then((()=>{c.style.display="none"})),await async function(e){if(!sessionStorage.getItem("requestInProgress")){sessionStorage.setItem("requestInProgress","true");const n=[],r=e.slice(),o=1,s=new AbortController,{signal:a}=s;window.addEventListener("beforeunload",(()=>s.abort()));const c=Array.from({length:o},(()=>t(r,n,a)));try{await Promise.all(c),console.log("all requests processed")}catch(e){"AbortError"===e.name?console.log("requests aborted due to page unload"):console.error("error processing requests",e)}finally{sessionStorage.removeItem("requestInProgress"),window.removeEventListener("beforeunload",(()=>s.abort()))}return n}return"Please wait until the current request is finished."}(e)}e.preventDefault()})),b.addEventListener("click",(()=>{w.close()}))})();